#!/bin/zsh -f

# My ZSH configuration which I try to keep as minimal and
# fast as possible.

# Use Emacs key bindings, ZSH will default this to
# Vim if the default editor is Vim.
bindkey -e

# Extend the path
typeset -U PATH path

# Environment
export LANG='en_US.UTF-8'
export LC_ALL='en_US.UTF-8'
export XDG_DATA_HOME=$HOME/.local/share

# Mac-specific stuff
if [[ "$(uname)" == "Darwin" ]]; then
  source ~/.zshrc.mac
else
  export EDITOR="nvim"
fi

# Path configuration
path+=(
  "$HOME/.local/bin"
  "$HOME/.cargo/bin"        # Rust
  "$HOME/.zvm/self"         # Zig
  "$HOME/.zvm/bin"
  "$HOME/.local/share/pnpm" # pnpm
)
[[ "$(uname)" != "Darwin" ]] && path+=("/opt/nvim/bin")  # Neovim (non-Mac)
export PATH

# Erlang
export KERL_CONFIGURE_OPTIONS="--disable-debug --without-javac"

# pnpm
export PNPM_HOME="$HOME/.local/share/pnpm"
alias pp='pnpm'
alias ppx='pnpx'

# Shortcuts
alias tt='tmux new-session -A -s main'

if (( $+commands[bat] ))
then
  alias cat='bat'
fi

# Magit on the commandline
if (( $+commands[gitu] ))
then
  alias gu='gitu'
fi

# Replace `ls` with `eza`, if installed
if (( $+commands[eza] ))
then
  alias ls='eza'                              # ls
  alias l='eza -lbF --git'                    # list, size, type, git
  alias ll='eza -lbGF --git'                  # long list
fi

# Some useful Git shortcuts
alias gc='git commit'
alias gs='git status --ignore-submodules=dirty'
alias gp='git push origin HEAD'
alias gf='git pull origin HEAD'

# Mise version manager
if (( $+commands[mise] ))
then
  eval "$(~/.local/bin/mise activate zsh)"
fi

# Setup environment variables per directory.
if (( $+commands[direnv] ))
then
  eval "$(direnv hook zsh)"
fi

# Quickly jump to directories with zoxide
if (( $+commands[zoxide] ))
then
  eval "$(zoxide init zsh)"
fi

# Better shell history with Atuin
if (( $+commands[atuin] ))
then
  eval "$(atuin init zsh)"
fi

# Fish like auto-suggestions
[[ -d "$HOME/.zsh/zsh-autosuggestions" ]] && source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh

# Fish like highlighting (using fast-syntax-highlighting for better performance)
[[ -d "$HOME/.zsh/fast-syntax-highlighting" ]] && source ~/.zsh/fast-syntax-highlighting/fast-syntax-highlighting.plugin.zsh

# Automatically close, delete and skip matching delimiting pairs.
if [[ -d "$HOME/.zsh/zsh-autopair" ]]; then
  source ~/.zsh/zsh-autopair/autopair.zsh
  autopair-init
fi

# Completion settings (must be before compinit)
zstyle ':completion:*' menu select
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache

# Enable autocompletion (rebuild once per day, skip security audit with -u)
autoload -Uz compinit
if [[ -n ~/.zcompdump(#qN.mh+24) ]]; then
  compinit -u
else
  compinit -Cu
fi

# The pure prompt
fpath+=($HOME/.zsh/pure)
PURE_PROMPT_SYMBOL='Î»'

autoload -U promptinit; promptinit
prompt pure
