#!/bin/bash
#
# Set font across Zed and Ghostty configurations
# Usage: set-font <font-name> [size]
#

set -e

DOTFILES="${DOTFILES:-$HOME/Code/dotfiles}"
ZED_CONFIG="$DOTFILES/zed/settings.json"
GHOSTTY_CONFIG="$DOTFILES/ghostty/config"

usage() {
    echo "Usage: set-font <font-name> [size]"
    echo ""
    echo "Examples:"
    echo "  set-font 'JetBrains Mono'"
    echo "  set-font 'JetBrains Mono' 14"
    exit 1
}

if [[ -z "$1" ]]; then
    usage
fi

FONT="$1"
SIZE="$2"

# Check for required tools
if ! command -v sed &> /dev/null; then
    echo "Error: sed is required but not installed"
    exit 1
fi

# Update Zed settings (using sed because Zed uses JSONC with trailing commas)
echo "Updating Zed settings..."

sed -i '' "s/\"buffer_font_family\": \"[^\"]*\"/\"buffer_font_family\": \"$FONT\"/" "$ZED_CONFIG"
sed -i '' "s/\"font_family\": \"[^\"]*\"/\"font_family\": \"$FONT\"/" "$ZED_CONFIG"

# Update sizes if provided
if [[ -n "$SIZE" ]]; then
    sed -i '' "s/\"buffer_font_size\": [0-9]*/\"buffer_font_size\": $SIZE/" "$ZED_CONFIG"
    sed -i '' "s/\"agent_buffer_font_size\": [0-9]*/\"agent_buffer_font_size\": $SIZE/" "$ZED_CONFIG"
    # Update terminal font_size (be specific to avoid matching other font_size fields)
    sed -i '' "/\"terminal\":/,/^  }/s/\"font_size\": [0-9]*/\"font_size\": $SIZE/" "$ZED_CONFIG"
fi

# Update Ghostty config
echo "Updating Ghostty config..."

# Update font-family
sed -i '' "s/^font-family = .*/font-family = $FONT/" "$GHOSTTY_CONFIG"

# Update font-size if provided
if [[ -n "$SIZE" ]]; then
    sed -i '' "s/^font-size = .*/font-size = $SIZE/" "$GHOSTTY_CONFIG"
fi

echo "Done! Font set to: $FONT${SIZE:+ (size: $SIZE)}"
